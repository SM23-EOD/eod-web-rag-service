<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Centro de Integraci√≥n ‚Äî EOD Web RAG</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --primary-light: #eff6ff;
      --bg: #f8fafc;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --success: #059669;
      --warning: #d97706;
      --danger: #ef4444;
      --radius: 16px;
      --sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --mono: 'SF Mono', 'Fira Code', Consolas, monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .header {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #fff;
      padding: 28px 40px 20px;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .header h1 {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header p {
      font-size: 13px;
      color: #94a3b8;
      max-width: 700px;
    }
    .header-actions {
      display: flex;
      gap: 10px;
    }
    .header-actions a {
      padding: 7px 16px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      transition: all .2s;
    }
    .header-actions .btn-outline {
      border: 1px solid rgba(255,255,255,.2);
      color: #cbd5e1;
    }
    .header-actions .btn-outline:hover {
      border-color: rgba(255,255,255,.4);
      color: #fff;
    }
    .header-actions .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    .header-actions .btn-primary:hover {
      background: #1d4ed8;
    }

    /* ‚îÄ‚îÄ Domain Nav ‚îÄ‚îÄ */
    .domain-nav {
      display: flex;
      gap: 6px;
      padding: 0 40px;
      background: #0f172a;
      overflow-x: auto;
    }
    .domain-tab {
      padding: 12px 20px;
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
      transition: all .2s;
    }
    .domain-tab:hover { color: #94a3b8; }
    .domain-tab.active {
      color: #fff;
      border-bottom-color: var(--primary);
    }
    .domain-tab .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      border-radius: 9px;
      font-size: 10px;
      font-weight: 700;
      margin-left: 6px;
      background: rgba(255,255,255,.1);
      color: #94a3b8;
    }
    .domain-tab.active .badge {
      background: var(--primary);
      color: #fff;
    }

    /* ‚îÄ‚îÄ Main content ‚îÄ‚îÄ */
    .main {
      padding: 28px 40px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .domain-section { display: none; }
    .domain-section.active { display: block; }

    .domain-header {
      margin-bottom: 24px;
    }
    .domain-header h2 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .domain-header p {
      font-size: 13px;
      color: var(--muted);
    }

    /* ‚îÄ‚îÄ Card grid ‚îÄ‚îÄ */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 18px;
      margin-bottom: 32px;
    }

    .interface-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      transition: all .2s;
      position: relative;
      overflow: hidden;
    }
    .interface-card:hover {
      border-color: #cbd5e1;
      box-shadow: 0 4px 20px rgba(0,0,0,.06);
      transform: translateY(-1px);
    }
    .interface-card .card-accent {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }

    .card-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .card-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .card-status {
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    .status-live { background: #ecfdf5; color: #059669; }
    .status-beta { background: #fef3c7; color: #92400e; }
    .status-test { background: #eff6ff; color: #2563eb; }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .card-desc {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 14px;
    }

    .card-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .tag {
      padding: 3px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      background: #f1f5f9;
      color: #475569;
    }
    .tag.proto-openai { background: #ecfdf5; color: #065f46; }
    .tag.proto-mcp { background: #eff6ff; color: #1e40af; }
    .tag.proto-rag { background: #fef3c7; color: #92400e; }

    .card-actions {
      display: flex;
      gap: 8px;
    }
    .card-actions a {
      flex: 1;
      text-align: center;
      padding: 9px 14px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      transition: all .2s;
    }
    .btn-open {
      background: var(--primary);
      color: #fff;
    }
    .btn-open:hover { background: #1d4ed8; }
    .btn-secondary {
      background: #f1f5f9;
      color: #475569;
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { background: #e2e8f0; }

    /* ‚îÄ‚îÄ Shared controls ‚îÄ‚îÄ */
    .range-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .range-row input[type="range"] { flex: 1; accent-color: var(--primary); }
    .range-val {
      font-family: var(--mono);
      font-size: 11px;
      font-weight: 600;
      color: var(--primary);
      min-width: 32px;
      text-align: right;
    }
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 0;
    }
    .toggle-row label { font-size: 12px; font-weight: 500; margin-bottom: 0; }
    .toggle {
      position: relative;
      width: 36px;
      height: 20px;
    }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .toggle .slider {
      position: absolute; cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #cbd5e1; border-radius: 20px; transition: .3s;
    }
    .toggle .slider::before {
      content: ''; position: absolute; height: 14px; width: 14px;
      left: 3px; bottom: 3px; background: #fff;
      border-radius: 50%; transition: .3s;
    }
    .toggle input:checked + .slider { background: var(--primary); }
    .toggle input:checked + .slider::before { transform: translateX(16px); }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    .footer {
      text-align: center;
      padding: 20px 40px;
      font-size: 11px;
      color: var(--muted);
      border-top: 1px solid var(--border);
    }
    .footer a { color: var(--primary); text-decoration: none; }

    /* ‚îÄ‚îÄ Section dividers ‚îÄ‚îÄ */
    .section-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .5px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ‚îÄ‚îÄ Generator: Widget card selector ‚îÄ‚îÄ */
    .gen-widget-cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    @media (max-width: 600px) { .gen-widget-cards { grid-template-columns: 1fr 1fr; } }
    .gen-wcard {
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all .2s;
      text-align: center;
    }
    .gen-wcard:hover { border-color: #94a3b8; }
    .gen-wcard.selected { border-color: var(--primary); background: var(--primary-light); }
    .gen-wcard .gw-icon { font-size: 22px; margin-bottom: 2px; }
    .gen-wcard .gw-name { font-size: 12px; font-weight: 600; }
    .gen-wcard .gw-tag { font-size: 10px; color: var(--muted); }

    /* ‚îÄ‚îÄ Generator layout ‚îÄ‚îÄ */
    .gen-layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
      overflow: hidden;
      min-height: 680px;
    }
    @media (max-width: 1024px) { .gen-layout { grid-template-columns: 1fr; } }
    .gen-sidebar {
      border-right: 1px solid var(--border);
      overflow-y: auto;
      max-height: 680px;
      background: #fafbfc;
    }
    .gen-sidebar-section {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    .gen-sidebar-section:last-child { border-bottom: none; }
    .gen-sidebar-section h4 {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
      color: var(--muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .gen-field { margin-bottom: 12px; }
    .gen-field:last-child { margin-bottom: 0; }
    .gen-field label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .gen-field .api-param {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--primary);
      background: var(--primary-light);
      padding: 1px 6px;
      border-radius: 4px;
    }
    .gen-field select,
    .gen-field input[type="text"],
    .gen-field input[type="number"] {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: var(--sans);
      background: #fff;
      transition: all .2s;
    }
    .gen-field select:focus,
    .gen-field input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,.1);
    }
    .gen-field textarea {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: var(--sans);
      resize: vertical;
      min-height: 52px;
      transition: all .2s;
    }
    .gen-field textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,.1);
    }
    .gen-help {
      font-size: 10px;
      color: var(--muted);
      margin-top: 3px;
      line-height: 1.4;
    }
    .gen-color-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .gen-color-row input[type="color"] {
      width: 32px; height: 32px;
      border: 2px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      padding: 1px;
    }
    .gen-color-row input[type="text"] { flex: 1; }

    /* ‚îÄ‚îÄ Generator preview panel ‚îÄ‚îÄ */
    .gen-preview {
      display: flex;
      flex-direction: column;
    }
    .gen-prev-tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border);
      background: #f8fafc;
      padding: 0 20px;
    }
    .gen-prev-tab {
      padding: 10px 18px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all .2s;
    }
    .gen-prev-tab:hover { color: var(--text); }
    .gen-prev-tab.active { color: var(--primary); border-bottom-color: var(--primary); }

    .gen-prev-content { flex: 1; overflow: auto; }
    .gen-tab-pane { display: none; }
    .gen-tab-pane.active { display: block; }
    .gen-tab-live {
      display: none;
      align-items: center;
      justify-content: center;
      min-height: 600px;
      padding: 20px;
      position: relative;
    }
    .gen-tab-live.active { display: flex; }
    .gen-live-host {
      width: 100%;
      height: 560px;
      position: relative;
    }

    /* ‚îÄ‚îÄ Code blocks ‚îÄ‚îÄ */
    .gen-code-block {
      background: #1e293b;
      color: #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      margin: 20px;
    }
    .gen-code-hdr {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      background: rgba(255,255,255,.05);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .gen-code-hdr span { font-size: 12px; font-weight: 600; color: #94a3b8; }
    .gen-copy-btn {
      padding: 4px 12px;
      background: rgba(255,255,255,.1);
      color: #e2e8f0;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all .2s;
    }
    .gen-copy-btn:hover { background: rgba(255,255,255,.2); }
    .gen-copy-btn.copied { background: var(--success); color: #fff; }
    .gen-code-body {
      padding: 16px;
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.7;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* ‚îÄ‚îÄ Endpoint summary ‚îÄ‚îÄ */
    .gen-ep-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      margin: 0 20px 20px;
    }
    .gen-ep-hdr {
      padding: 12px 16px;
      background: #f8fafc;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .gen-ep-hdr h5 { font-size: 13px; font-weight: 600; }
    .gen-method {
      font-size: 10px;
      font-weight: 700;
      padding: 2px 7px;
      border-radius: 5px;
      font-family: var(--mono);
      background: #dbeafe;
      color: #1d4ed8;
    }
    .gen-proto-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
    }
    .gen-proto-badge.openai { background: #ecfdf5; color: #059669; }
    .gen-proto-badge.mcp { background: #eff6ff; color: #2563eb; }
    .gen-ep-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    .gen-ep-table th {
      text-align: left;
      padding: 8px 16px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .3px;
      color: var(--muted);
      font-weight: 600;
      border-bottom: 1px solid var(--border);
    }
    .gen-ep-table td {
      padding: 6px 16px;
      border-bottom: 1px solid #f1f5f9;
    }
    .gen-ep-table tr:last-child td { border-bottom: none; }
    .gen-ep-table code {
      font-family: var(--mono);
      font-size: 11px;
      background: #f1f5f9;
      padding: 1px 5px;
      border-radius: 3px;
    }
    .gen-val-active { color: var(--primary); font-weight: 600; }
    .gen-val-default { color: var(--muted); }

    /* ‚îÄ‚îÄ Generator footer bar ‚îÄ‚îÄ */
    .gen-footer-bar {
      display: flex;
      gap: 14px;
      padding: 12px 20px;
      background: #f8fafc;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }
    .gen-footer-bar .gf-tag {
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
    }
  </style>
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="header">
    <div class="header-top">
      <div>
        <h1>üß© Centro de Integraci√≥n</h1>
        <p>Hub centralizado de todas las interfaces del sistema RAG ‚Äî organizado por dominio funcional</p>
      </div>
      <div class="header-actions">
        <a href="dashboard.html" class="btn-outline">üìä Admin Dashboard</a>
        <a href="widget-generator.html" class="btn-primary">üõ†Ô∏è Widget Generator</a>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DOMAIN TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="domain-nav">
    <div class="domain-tab active" onclick="switchDomain('overview', this)">üìã Vista General <span class="badge">13</span></div>
    <div class="domain-tab" onclick="switchDomain('widgets', this)">üí¨ Widget Demos <span class="badge">4</span></div>
    <div class="domain-tab" onclick="switchDomain('eval', this)">üß™ Evaluaci√≥n <span class="badge">3</span></div>
    <div class="domain-tab" onclick="switchDomain('abtest', this)">üìä A/B Testing <span class="badge">3</span></div>
    <div class="domain-tab" onclick="switchDomain('tools', this)">üõ†Ô∏è Herramientas <span class="badge">2</span></div>
    <div class="domain-tab" onclick="switchDomain('generator', this)">üõ†Ô∏è Widget Generator</div>
  </nav>

  <div class="main">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section active" id="sec-overview">
      <div class="domain-header">
        <h2>Vista General de Interfaces</h2>
        <p>Todas las interfaces desplegadas del sistema EOD Web RAG, organizadas por dominio funcional</p>
      </div>

      <!-- Operations -->
      <div class="section-label">‚öôÔ∏è Operaciones & Admin</div>
      <div class="card-grid">
        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#2563eb,#7c3aed)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#eff6ff">üìä</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Admin Dashboard</div>
          <div class="card-desc">Dashboard completo con 6 m√≥dulos: Chat, Documentos, Tenants, Agentes, Analytics y Admin MCP</div>
          <div class="card-tags">
            <span class="tag proto-mcp">MCP</span>
            <span class="tag proto-openai">OpenAI</span>
            <span class="tag">api-client.js</span>
            <span class="tag">6 m√≥dulos</span>
          </div>
          <div class="card-actions">
            <a href="dashboard.html" class="btn-open">Abrir Dashboard</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#2563eb,#06b6d4)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#eff6ff">üí¨</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Chat Interface</div>
          <div class="card-desc">Interfaz de chat full-page estilo ChatGPT con historial, sidebar y endpoint configurable</div>
          <div class="card-tags">
            <span class="tag proto-mcp">MCP</span>
            <span class="tag">Full-page</span>
            <span class="tag">Standalone</span>
          </div>
          <div class="card-actions">
            <a href="chat-interface.html" class="btn-open">Abrir Chat</a>
          </div>
        </div>
      </div>

      <!-- Widgets -->
      <div class="section-label">üí¨ Widget Demos</div>
      <div class="card-grid">
        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#8b5cf6,#ec4899)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#faf5ff">‚ú®</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">DRAGA Chat</div>
          <div class="card-desc">Widget multi-protocolo con sources, confianza, grounding, feedback e i18n</div>
          <div class="card-tags">
            <span class="tag proto-openai">OpenAI</span>
            <span class="tag proto-mcp">MCP</span>
            <span class="tag">Multi-protocolo</span>
            <span class="tag">i18n</span>
          </div>
          <div class="card-actions">
            <a href="demo-draga-chat.html" class="btn-open">Demo</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#059669,#10b981)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#ecfdf5">‚ö°</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Widget OpenAI</div>
          <div class="card-desc">Widget OpenAI-compatible con SSE streaming, feedback con comentario y system prompt</div>
          <div class="card-tags">
            <span class="tag proto-openai">OpenAI</span>
            <span class="tag">SSE Streaming</span>
            <span class="tag">Feedback</span>
          </div>
          <div class="card-actions">
            <a href="demo-widget-openai.html" class="btn-open">Demo</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#2563eb,#3b82f6)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#eff6ff">ü§ñ</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Widget V2</div>
          <div class="card-desc">Widget MCP mejorado con posici√≥n configurable, theme color y feedback con comentarios</div>
          <div class="card-tags">
            <span class="tag proto-mcp">MCP</span>
            <span class="tag">Shadow DOM</span>
            <span class="tag">Feedback</span>
          </div>
          <div class="card-actions">
            <a href="demo-widget-v2.html" class="btn-open">Demo</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#64748b,#94a3b8)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#f1f5f9">üì¶</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Widget V1</div>
          <div class="card-desc">Widget MCP original con sources, feedback y markdown rendering</div>
          <div class="card-tags">
            <span class="tag proto-mcp">MCP</span>
            <span class="tag">Legacy</span>
          </div>
          <div class="card-actions">
            <a href="index.html" class="btn-open">Demo</a>
          </div>
        </div>
      </div>

      <!-- Evaluation -->
      <div class="section-label">üß™ Evaluaci√≥n & QA</div>
      <div class="card-grid">
        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#d97706,#f59e0b)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#fef3c7">üß™</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Centro de Evaluaci√≥n</div>
          <div class="card-desc">4 vistas de evaluaci√≥n: QA estructurado, ChatGPT, Widget V2 y V1 con sidebar de preguntas r√°pidas</div>
          <div class="card-tags">
            <span class="tag proto-mcp">MCP</span>
            <span class="tag">Multi-vista</span>
            <span class="tag">QA</span>
          </div>
          <div class="card-actions">
            <a href="evaluation.html" class="btn-open">Abrir</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#d97706,#fbbf24)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#fef3c7">üìà</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Evaluation Dashboard</div>
          <div class="card-desc">Analytics de sesiones de evaluaci√≥n con charts, tablas y export desde localStorage</div>
          <div class="card-tags">
            <span class="tag">localStorage</span>
            <span class="tag">Charts</span>
          </div>
          <div class="card-actions">
            <a href="evaluation-dashboard.html" class="btn-open">Abrir</a>
          </div>
        </div>
      </div>

      <!-- A/B -->
      <div class="section-label">üìä A/B Testing</div>
      <div class="card-grid">
        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#7c3aed,#a78bfa)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#f5f3ff">üî¨</div>
            <span class="card-status status-beta">‚óè Beta</span>
          </div>
          <div class="card-title">A/B Test ‚Äî B√°sico</div>
          <div class="card-desc">Test A/B entre Widget V1 y V2 con integraci√≥n GTM/dataLayer</div>
          <div class="card-tags">
            <span class="tag">V1 vs V2</span>
            <span class="tag">GTM</span>
          </div>
          <div class="card-actions">
            <a href="ab-test.html" class="btn-open">Abrir</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#7c3aed,#c084fc)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#f5f3ff">üì°</div>
            <span class="card-status status-beta">‚óè Beta</span>
          </div>
          <div class="card-title">A/B Test ‚Äî Full</div>
          <div class="card-desc">Integraci√≥n completa con GA4 + analytics backend para m√©tricas de engagement</div>
          <div class="card-tags">
            <span class="tag">GA4</span>
            <span class="tag">Backend Analytics</span>
          </div>
          <div class="card-actions">
            <a href="ab-test-full.html" class="btn-open">Abrir</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#7c3aed,#e879f9)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#f5f3ff">üß¨</div>
            <span class="card-status status-test">‚óè Tests</span>
          </div>
          <div class="card-title">A/B Test ‚Äî Unit Tests</div>
          <div class="card-desc">Suite de tests in-browser para el framework de A/B testing</div>
          <div class="card-tags">
            <span class="tag">Unit Tests</span>
            <span class="tag">ab-test-loader</span>
          </div>
          <div class="card-actions">
            <a href="ab-test-tests.html" class="btn-open">Ejecutar Tests</a>
          </div>
        </div>
      </div>

      <!-- Tools -->
      <div class="section-label">üõ†Ô∏è Herramientas</div>
      <div class="card-grid">
        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#0891b2,#06b6d4)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#ecfeff">üõ†Ô∏è</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Widget Generator</div>
          <div class="card-desc">Configurador visual de widgets con todos los par√°metros API, preview en vivo y c√≥digo de embed</div>
          <div class="card-tags">
            <span class="tag">4 widgets</span>
            <span class="tag">Code Gen</span>
            <span class="tag">Live Preview</span>
          </div>
          <div class="card-actions">
            <a href="widget-generator.html" class="btn-open">Abrir</a>
          </div>
        </div>

        <div class="interface-card">
          <div class="card-accent" style="background:linear-gradient(90deg,#0891b2,#22d3ee)"></div>
          <div class="card-head">
            <div class="card-icon" style="background:#ecfeff">üéØ</div>
            <span class="card-status status-live">‚óè Live</span>
          </div>
          <div class="card-title">Centro de Integraci√≥n</div>
          <div class="card-desc">Esta p√°gina ‚Äî hub centralizado de todas las interfaces con chat de evaluaci√≥n integrado</div>
          <div class="card-tags">
            <span class="tag">Hub</span>
            <span class="tag">Chat Eval</span>
          </div>
          <div class="card-actions">
            <a href="integration.html" class="btn-secondary">Est√°s aqu√≠</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WIDGETS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section" id="sec-widgets">
      <div class="domain-header">
        <h2>Widget Demos</h2>
        <p>Demos interactivos de los 4 widgets web component del sistema RAG</p>
      </div>
      <div class="card-grid" id="widgets-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EVALUATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section" id="sec-eval">
      <div class="domain-header">
        <h2>Evaluaci√≥n & QA</h2>
        <p>Herramientas de evaluaci√≥n de calidad del RAG y dashboards de m√©tricas</p>
      </div>
      <div class="card-grid" id="eval-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê A/B TESTING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section" id="sec-abtest">
      <div class="domain-header">
        <h2>A/B Testing</h2>
        <p>Framework de A/B testing para comparar variantes de widgets</p>
      </div>
      <div class="card-grid" id="abtest-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOOLS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section" id="sec-tools">
      <div class="domain-header">
        <h2>Herramientas</h2>
        <p>Generadores y utilidades para configuraci√≥n de widgets</p>
      </div>
      <div class="card-grid" id="tools-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WIDGET GENERATOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="domain-section" id="sec-generator">
      <div class="domain-header">
        <h2>üõ†Ô∏è Widget Generator</h2>
        <p>Configura cualquier widget del sistema con protocolo y par√°metros completos ‚Äî vista previa en vivo, c√≥digo HTML y request API</p>
      </div>

      <!-- Widget selector cards -->
      <div class="gen-widget-cards" id="gen-widget-sel">
        <div class="gen-wcard selected" data-widget="draga-chat" onclick="genSelectWidget(this)">
          <div class="gw-icon">üí¨</div>
          <div class="gw-name">DRAGA Chat</div>
          <div class="gw-tag">Multi-protocolo</div>
        </div>
        <div class="gen-wcard" data-widget="rag-assistant-openai" onclick="genSelectWidget(this)">
          <div class="gw-icon">‚ö°</div>
          <div class="gw-name">OpenAI Widget</div>
          <div class="gw-tag">SSE Streaming</div>
        </div>
        <div class="gen-wcard" data-widget="rag-assistant-v2" onclick="genSelectWidget(this)">
          <div class="gw-icon">ü§ñ</div>
          <div class="gw-name">Widget V2</div>
          <div class="gw-tag">MCP Protocol</div>
        </div>
        <div class="gen-wcard" data-widget="rag-assistant" onclick="genSelectWidget(this)">
          <div class="gw-icon">üì¶</div>
          <div class="gw-name">Widget V1</div>
          <div class="gw-tag">MCP B√°sico</div>
        </div>
      </div>

      <!-- Generator layout: sidebar + preview -->
      <div class="gen-layout">
        <div class="gen-sidebar">

          <!-- Connection -->
          <div class="gen-sidebar-section">
            <h4>üîå Conexi√≥n</h4>
            <div class="gen-field" id="gf-protocol">
              <label>Protocolo <span class="api-param">protocol</span></label>
              <select id="gen-protocol" onchange="genUpdate()">
                <option value="openai">OpenAI (Chat Completions)</option>
                <option value="rag" disabled>RAG (Direct Query) ‚Äî no disponible</option>
                <option value="mcp">MCP (Tool Call)</option>
              </select>
              <div class="gen-help">‚ö†Ô∏è RAG endpoint no implementado en el backend actual</div>
            </div>
            <div class="gen-field">
              <label>Base URL <span class="api-param">base-url</span></label>
              <input type="text" id="gen-baseurl" value="/api/v2" oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-agent">
              <label>Agent <span class="api-param">agent</span></label>
              <input type="text" id="gen-agent" value="eod" oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-apikey">
              <label>API Key <span class="api-param">X-API-Key</span></label>
              <input type="text" id="gen-apikey" value="" placeholder="(opcional)" oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-model">
              <label>Modelo <span class="api-param">model</span></label>
              <input type="text" id="gen-model" value="eod-rag" oninput="genUpdate()">
            </div>
          </div>

          <!-- Query params -->
          <div class="gen-sidebar-section">
            <h4>üîç Query</h4>
            <div class="gen-field" id="gf-topk">
              <label>Top K <span class="api-param">top_k</span></label>
              <div class="range-row">
                <input type="range" id="gen-topk" min="1" max="20" value="5" oninput="genUpdate()">
                <span class="range-val" id="gv-topk">5</span>
              </div>
              <div class="gen-help">Fragmentos de documentos a recuperar</div>
            </div>
            <div class="gen-field" id="gf-temperature">
              <label>Temperatura <span class="api-param">temperature</span></label>
              <div class="range-row">
                <input type="range" id="gen-temperature" min="0" max="100" value="30" oninput="genUpdate()">
                <span class="range-val" id="gv-temperature">0.3</span>
              </div>
              <div class="gen-help">0 = determin√≠stico, 1 = creativo</div>
            </div>
            <div class="gen-field" id="gf-similarity">
              <label>Similitud <span class="api-param">similarity_threshold</span></label>
              <div class="range-row">
                <input type="range" id="gen-similarity" min="0" max="100" value="30" oninput="genUpdate()">
                <span class="range-val" id="gv-similarity">0.30</span>
              </div>
            </div>
            <div class="gen-field" id="gf-maxtokens">
              <label>Max tokens <span class="api-param">max_tokens</span></label>
              <div class="range-row">
                <input type="range" id="gen-maxtokens" min="256" max="8192" value="2048" step="256" oninput="genUpdate()">
                <span class="range-val" id="gv-maxtokens">2048</span>
              </div>
            </div>
            <div class="gen-field" id="gf-maxhistory">
              <label>Max historial <span class="api-param">max-history</span></label>
              <div class="range-row">
                <input type="range" id="gen-maxhistory" min="1" max="50" value="20" oninput="genUpdate()">
                <span class="range-val" id="gv-maxhistory">20</span>
              </div>
            </div>
            <div class="gen-field" id="gf-toolname">
              <label>Tool name <span class="api-param">tool_name</span></label>
              <input type="text" id="gen-toolname" value="generate_rag_answer" oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-systemprompt">
              <label>System prompt <span class="api-param">system-prompt</span></label>
              <textarea id="gen-systemprompt" placeholder="Eres un asistente de ayuda..." oninput="genUpdate()"></textarea>
            </div>
          </div>

          <!-- Features -->
          <div class="gen-sidebar-section">
            <h4>‚ú® Funciones</h4>
            <div class="toggle-row">
              <label>Streaming <span style="font-family:var(--mono);font-size:10px;color:var(--muted);margin-left:4px">stream</span></label>
              <label class="toggle"><input type="checkbox" id="gen-streaming" checked onchange="genUpdate()"><span class="slider"></span></label>
            </div>
            <div class="toggle-row" id="gf-sources">
              <label>Fuentes <span style="font-family:var(--mono);font-size:10px;color:var(--muted);margin-left:4px">include_sources</span></label>
              <label class="toggle"><input type="checkbox" id="gen-sources" checked onchange="genUpdate()"><span class="slider"></span></label>
            </div>
            <div class="toggle-row" id="gf-confidence">
              <label>Confianza <span style="font-family:var(--mono);font-size:10px;color:var(--muted);margin-left:4px">show-confidence</span></label>
              <label class="toggle"><input type="checkbox" id="gen-confidence" onchange="genUpdate()"><span class="slider"></span></label>
            </div>
            <div class="toggle-row" id="gf-grounding">
              <label>Grounding <span style="font-family:var(--mono);font-size:10px;color:var(--muted);margin-left:4px">show-grounding</span></label>
              <label class="toggle"><input type="checkbox" id="gen-grounding" onchange="genUpdate()"><span class="slider"></span></label>
            </div>
            <div class="toggle-row" id="gf-feedback">
              <label>Feedback <span style="font-family:var(--mono);font-size:10px;color:var(--muted);margin-left:4px">POST /feedback</span></label>
              <label class="toggle"><input type="checkbox" id="gen-feedback" checked onchange="genUpdate()"><span class="slider"></span></label>
            </div>
          </div>

          <!-- Appearance -->
          <div class="gen-sidebar-section">
            <h4>üé® Apariencia</h4>
            <div class="gen-field">
              <label>Color <span class="api-param">--draga-primary</span></label>
              <div class="gen-color-row">
                <input type="color" id="gen-color-pick" value="#2563eb" oninput="document.getElementById('gen-color').value=this.value;genUpdate()">
                <input type="text" id="gen-color" value="#2563eb" oninput="if(/^#[0-9a-fA-F]{6}$/.test(this.value))document.getElementById('gen-color-pick').value=this.value;genUpdate()">
              </div>
            </div>
            <div class="gen-field">
              <label>Posici√≥n <span class="api-param">position</span></label>
              <select id="gen-position" onchange="genUpdate()">
                <option value="bottom-right">Bottom Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="inline" selected>Inline (embedded)</option>
              </select>
            </div>
            <div class="gen-field">
              <label>Idioma <span class="api-param">locale</span></label>
              <select id="gen-locale" onchange="genUpdate()">
                <option value="es">Espa√±ol</option>
                <option value="en">English</option>
              </select>
            </div>
            <div class="gen-field" id="gf-title">
              <label>T√≠tulo <span class="api-param">title</span></label>
              <input type="text" id="gen-title" value="Asistente Virtual" oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-placeholder">
              <label>Placeholder <span class="api-param">placeholder</span></label>
              <input type="text" id="gen-placeholder" value="Escribe tu consulta..." oninput="genUpdate()">
            </div>
            <div class="gen-field" id="gf-sessionid">
              <label>Session ID <span class="api-param">session-id</span></label>
              <input type="text" id="gen-sessionid" value="web" oninput="genUpdate()">
            </div>
          </div>
        </div>

        <!-- Preview -->
        <div class="gen-preview">
          <div class="gen-prev-tabs">
            <div class="gen-prev-tab active" onclick="genSwitchTab('live',this)">üëÅÔ∏è Vista previa</div>
            <div class="gen-prev-tab" onclick="genSwitchTab('html',this)">üìã HTML Embed</div>
            <div class="gen-prev-tab" onclick="genSwitchTab('api',this)">üì° API Request</div>
          </div>
          <div class="gen-prev-content">
            <div class="gen-tab-live active" id="gen-tab-live">
              <div class="gen-live-host" id="gen-preview-host"></div>
            </div>
            <div class="gen-tab-pane" id="gen-tab-html">
              <div class="gen-code-block">
                <div class="gen-code-hdr">
                  <span>HTML ‚Äî C√≥digo de embedding</span>
                  <button class="gen-copy-btn" onclick="genCopy('gen-code-embed')">üìã Copiar</button>
                </div>
                <pre class="gen-code-body" id="gen-code-embed"></pre>
              </div>
            </div>
            <div class="gen-tab-pane" id="gen-tab-api">
              <div class="gen-code-block">
                <div class="gen-code-hdr">
                  <span>cURL ‚Äî Request que enviar√° el widget</span>
                  <button class="gen-copy-btn" onclick="genCopy('gen-code-curl')">üìã Copiar</button>
                </div>
                <pre class="gen-code-body" id="gen-code-curl"></pre>
              </div>
              <div id="gen-ep-summary"></div>
            </div>
          </div>
          <div class="gen-footer-bar">
            <span>Widget:</span> <span class="gf-tag" id="gen-footer-widget">draga-chat</span>
            <span>Protocolo:</span> <span class="gf-tag" id="gen-footer-proto">openai</span>
            <span>Streaming:</span> <span class="gf-tag" id="gen-footer-stream">true</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">
    EOD Web RAG Service ‚Äî Centro de Integraci√≥n v1.0 ¬∑ <a href="https://github.com/SM23-EOD/eod-web-rag-service">GitHub</a>
  </div>

  <!-- All widget scripts -->
  <script src="src/draga-chat.js"></script>
  <script src="src/assistant-widget-openai.js"></script>
  <script src="src/assistant-widget-v2.js"></script>
  <script src="src/assistant-widget.js"></script>

  <script>
    // ‚îÄ‚îÄ Full widget capability matrix (same pattern for all widgets) ‚îÄ‚îÄ
    const CAPS = {
      'draga-chat': {
        tag: 'draga-chat', script: 'src/draga-chat.js',
        protocols: ['openai','mcp'],
        hasProtocol: true, hasAgent: true, hasApiKey: true, hasModel: true,
        hasTopK: false, hasTemperature: false, hasSimilarity: false, hasMaxTokens: false,
        hasMaxHistory: true, hasToolName: false, hasSystemPrompt: false,
        hasStreaming: true, hasSources: true, hasConfidence: true, hasGrounding: true, hasFeedback: true,
        hasPosition: true, hasLocale: true, hasTitle: false, hasPlaceholder: false, hasSessionId: false, hasColor: true,
        baseUrlAttr: 'base-url', endpointSuffix: '',
      },
      'rag-assistant-openai': {
        tag: 'rag-assistant-openai', script: 'src/assistant-widget-openai.js',
        protocols: ['openai'],
        hasProtocol: false, hasAgent: false, hasApiKey: false, hasModel: true,
        hasTopK: true, hasTemperature: true, hasSimilarity: false, hasMaxTokens: false,
        hasMaxHistory: false, hasToolName: false, hasSystemPrompt: true,
        hasStreaming: true, hasSources: false, hasConfidence: false, hasGrounding: false, hasFeedback: false,
        hasPosition: true, hasLocale: false, hasTitle: true, hasPlaceholder: true, hasSessionId: true, hasColor: true,
        baseUrlAttr: 'endpoint', endpointSuffix: '',
      },
      'rag-assistant-v2': {
        tag: 'rag-assistant-v2', script: 'src/assistant-widget-v2.js',
        protocols: ['mcp'],
        hasProtocol: false, hasAgent: false, hasApiKey: false, hasModel: false,
        hasTopK: false, hasTemperature: false, hasSimilarity: false, hasMaxTokens: false,
        hasMaxHistory: false, hasToolName: true, hasSystemPrompt: false,
        hasStreaming: false, hasSources: true, hasConfidence: false, hasGrounding: false, hasFeedback: false,
        hasPosition: true, hasLocale: false, hasTitle: true, hasPlaceholder: true, hasSessionId: true, hasColor: true,
        baseUrlAttr: 'endpoint', endpointSuffix: '/mcp/tools/call',
      },
      'rag-assistant': {
        tag: 'rag-assistant', script: 'src/assistant-widget.js',
        protocols: ['mcp'],
        hasProtocol: false, hasAgent: false, hasApiKey: false, hasModel: false,
        hasTopK: false, hasTemperature: false, hasSimilarity: false, hasMaxTokens: false,
        hasMaxHistory: false, hasToolName: true, hasSystemPrompt: false,
        hasStreaming: false, hasSources: true, hasConfidence: false, hasGrounding: false, hasFeedback: false,
        hasPosition: false, hasLocale: false, hasTitle: true, hasPlaceholder: true, hasSessionId: true, hasColor: false,
        baseUrlAttr: 'endpoint', endpointSuffix: '/mcp/tools/call',
      },
    };

    let genSelected = 'draga-chat';
    const $ = id => document.getElementById(id);
    const show = (id, v) => { const el = $(id); if (el) el.style.display = v ? '' : 'none'; };

    // ‚îÄ‚îÄ Domain tab switching ‚îÄ‚îÄ
    function switchDomain(name, el) {
      document.querySelectorAll('.domain-tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      document.querySelectorAll('.domain-section').forEach(s => s.classList.remove('active'));
      document.getElementById('sec-' + name).classList.add('active');

      if (name === 'widgets') populateGrid('widgets-grid', ['demo-draga-chat.html','demo-widget-openai.html','demo-widget-v2.html','index.html']);
      if (name === 'eval') populateGrid('eval-grid', ['evaluation.html','evaluation-dashboard.html']);
      if (name === 'abtest') populateGrid('abtest-grid', ['ab-test.html','ab-test-full.html','ab-test-tests.html']);
      if (name === 'tools') populateGrid('tools-grid', ['widget-generator.html','integration.html']);
      if (name === 'generator' && !$('gen-preview-host').children.length) genUpdatePreview();
    }

    function populateGrid(gridId, pages) {
      const grid = $(gridId);
      if (grid.children.length) return;
      const overview = $('sec-overview');
      pages.forEach(page => {
        const card = overview.querySelector(`a[href="${page}"]`);
        if (card) grid.appendChild(card.closest('.interface-card').cloneNode(true));
      });
    }

    // ‚îÄ‚îÄ Generator: Widget selector ‚îÄ‚îÄ
    function genSelectWidget(el) {
      document.querySelectorAll('.gen-wcard').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      genSelected = el.dataset.widget;
      genApplyVisibility();
      genUpdate();
    }

    function genApplyVisibility() {
      const cap = CAPS[genSelected];
      show('gf-protocol', cap.hasProtocol);
      if (cap.hasProtocol) {
        $('gen-protocol').querySelectorAll('option').forEach(o => {
          o.disabled = !cap.protocols.includes(o.value);
        });
        if (!cap.protocols.includes($('gen-protocol').value)) $('gen-protocol').value = cap.protocols[0];
      }
      show('gf-agent', cap.hasAgent);
      show('gf-apikey', cap.hasApiKey);
      show('gf-model', cap.hasModel);
      show('gf-topk', cap.hasTopK);
      show('gf-temperature', cap.hasTemperature);
      show('gf-similarity', cap.hasSimilarity);
      show('gf-maxtokens', cap.hasMaxTokens);
      show('gf-maxhistory', cap.hasMaxHistory);
      show('gf-toolname', cap.hasToolName);
      show('gf-systemprompt', cap.hasSystemPrompt);
      show('gf-sources', cap.hasSources);
      show('gf-confidence', cap.hasConfidence);
      show('gf-grounding', cap.hasGrounding);
      show('gf-feedback', cap.hasFeedback);
      show('gf-title', cap.hasTitle);
      show('gf-placeholder', cap.hasPlaceholder);
      show('gf-sessionid', cap.hasSessionId);
    }

    // ‚îÄ‚îÄ Gather config ‚îÄ‚îÄ
    function genGetConfig() {
      return {
        widget: genSelected,
        protocol: $('gen-protocol').value,
        baseUrl: $('gen-baseurl').value.replace(/\/+$/, ''),
        agent: $('gen-agent').value,
        apiKey: $('gen-apikey').value,
        model: $('gen-model').value,
        topK: parseInt($('gen-topk').value),
        temperature: parseInt($('gen-temperature').value) / 100,
        similarity: parseInt($('gen-similarity').value) / 100,
        maxTokens: parseInt($('gen-maxtokens').value),
        maxHistory: parseInt($('gen-maxhistory').value),
        toolName: $('gen-toolname').value,
        systemPrompt: $('gen-systemprompt').value,
        streaming: $('gen-streaming').checked,
        sources: $('gen-sources').checked,
        confidence: $('gen-confidence').checked,
        grounding: $('gen-grounding').checked,
        feedback: $('gen-feedback').checked,
        color: $('gen-color').value,
        position: $('gen-position').value,
        locale: $('gen-locale').value,
        title: $('gen-title').value,
        placeholder: $('gen-placeholder').value,
        sessionId: $('gen-sessionid').value,
      };
    }

    function escHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

    // ‚îÄ‚îÄ Generate HTML embed ‚îÄ‚îÄ
    function genBuildEmbed(cfg) {
      const cap = CAPS[cfg.widget];
      const attrs = [];
      if (cap.endpointSuffix) {
        attrs.push(`  ${cap.baseUrlAttr}="${cfg.baseUrl}${cap.endpointSuffix}"`);
      } else {
        attrs.push(`  ${cap.baseUrlAttr}="${cfg.baseUrl}"`);
      }
      if (cap.hasProtocol) attrs.push(`  protocol="${cfg.protocol}"`);
      if (cap.hasAgent) attrs.push(`  agent="${cfg.agent}"`);
      if (cap.hasApiKey && cfg.apiKey) attrs.push(`  api-key="${cfg.apiKey}"`);
      if (cap.hasModel) attrs.push(`  model="${cfg.model}"`);
      if (cap.hasTopK) attrs.push(`  top-k="${cfg.topK}"`);
      if (cap.hasTemperature) attrs.push(`  temperature="${cfg.temperature}"`);
      if (cap.hasMaxHistory) attrs.push(`  max-history="${cfg.maxHistory}"`);
      if (cap.hasToolName) attrs.push(`  tool-name="${cfg.toolName}"`);
      if (cap.hasSystemPrompt && cfg.systemPrompt) attrs.push(`  system-prompt="${escHtml(cfg.systemPrompt)}"`);
      if (cap.hasStreaming) attrs.push(`  streaming="${cfg.streaming}"`);
      if (cap.hasSources) attrs.push(`  show-sources="${cfg.sources}"`);
      if (cap.hasConfidence && cfg.confidence) attrs.push(`  show-confidence="true"`);
      if (cap.hasGrounding && cfg.grounding) attrs.push(`  show-grounding="true"`);
      if (cap.hasFeedback) attrs.push(`  feedback="${cfg.feedback}"`);
      if (cap.hasPosition) attrs.push(`  position="${cfg.position}"`);
      if (cap.hasLocale) attrs.push(`  locale="${cfg.locale}"`);
      if (cap.hasTitle) attrs.push(`  title="${escHtml(cfg.title)}"`);
      if (cap.hasPlaceholder) attrs.push(`  placeholder="${escHtml(cfg.placeholder)}"`);
      if (cap.hasSessionId) attrs.push(`  session-id="${cfg.sessionId}"`);
      if (cap.hasColor && cap.tag !== 'draga-chat') attrs.push(`  theme-color="${cfg.color}"`);

      let html = `<!-- Widget: ${cap.tag} -->\n<script src="${cap.script}"><\/script>\n\n<${cap.tag}\n${attrs.join('\n')}\n></${cap.tag}>`;
      if (cap.hasColor && cap.tag === 'draga-chat') {
        html += `\n\n<style>\n  draga-chat {\n    --draga-primary: ${cfg.color};\n  }\n</style>`;
      }
      return html;
    }

    // ‚îÄ‚îÄ Generate cURL ‚îÄ‚îÄ
    function genBuildCurl(cfg) {
      const cap = CAPS[cfg.widget];
      const protocol = cap.hasProtocol ? cfg.protocol : cap.protocols[0];
      let url, body, headers = ['-H "Content-Type: application/json"'];
      if (cfg.apiKey) headers.push(`-H "X-API-Key: ${cfg.apiKey}"`);

      switch (protocol) {
        case 'openai': {
          url = `${cfg.baseUrl}/chat/completions`;
          body = {
            model: cfg.model,
            messages: [{ role: 'system', content: cfg.systemPrompt || '(system prompt)' }, { role: 'user', content: '¬øCu√°l es tu pregunta de ejemplo?' }],
            stream: cfg.streaming, top_k: cfg.topK, temperature: cfg.temperature,
          };
          if (cap.hasAgent || cfg.agent) body.tenant_id = cfg.agent;
          if (cfg.maxTokens && cfg.maxTokens !== 2048) body.max_tokens = cfg.maxTokens;
          body.similarity_threshold = cfg.similarity;
          body.include_sources = cfg.sources;
          break;
        }
        case 'mcp': {
          url = `${cfg.baseUrl}/mcp/tools/call`;
          body = { tool_name: cfg.toolName, arguments: { query: '¬øCu√°l es tu pregunta de ejemplo?', include_sources: cfg.sources }, session_id: cfg.sessionId };
          if (cfg.agent) body.arguments.tenant_id = cfg.agent;
          break;
        }
      }
      return `curl -X POST "${url}" \\\n  ${headers.join(' \\\n  ')} \\\n  -d '${JSON.stringify(body, null, 2)}'`;
    }

    // ‚îÄ‚îÄ Endpoint summary ‚îÄ‚îÄ
    function genBuildEpSummary(cfg) {
      const cap = CAPS[cfg.widget];
      const protocol = cap.hasProtocol ? cfg.protocol : cap.protocols[0];
      const epMap = {
        openai: { method: 'POST', path: '/chat/completions', label: 'Chat Completions' },
        mcp: { method: 'POST', path: '/mcp/tools/call', label: 'MCP Tool Call' },
      };
      const ep = epMap[protocol];
      const params = [];
      if (protocol === 'openai') {
        params.push({ n: 'model', v: cfg.model, d: 'eod-rag' });
        params.push({ n: 'messages', v: `[...${cfg.maxHistory} turns]`, d: '‚Äî' });
        params.push({ n: 'stream', v: String(cfg.streaming), d: 'true' });
        params.push({ n: 'top_k', v: String(cfg.topK), d: '5' });
        params.push({ n: 'temperature', v: String(cfg.temperature), d: '0.3' });
        params.push({ n: 'similarity_threshold', v: cfg.similarity.toFixed(2), d: '0.30' });
        params.push({ n: 'max_tokens', v: String(cfg.maxTokens), d: '2048' });
        params.push({ n: 'include_sources', v: String(cfg.sources), d: 'true' });
        params.push({ n: 'tenant_id', v: cfg.agent || '‚Äî', d: '‚Äî' });
      } else {
        params.push({ n: 'tool_name', v: cfg.toolName, d: 'generate_rag_answer' });
        params.push({ n: 'arguments.query', v: '(user input)', d: '‚Äî' });
        params.push({ n: 'arguments.include_sources', v: String(cfg.sources), d: 'true' });
        params.push({ n: 'session_id', v: cfg.sessionId, d: 'web' });
      }
      const rows = params.map(p => {
        const changed = p.v !== p.d;
        return `<tr><td><code>${p.n}</code></td><td class="${changed?'gen-val-active':'gen-val-default'}">${escHtml(p.v)}</td><td class="gen-val-default">${escHtml(p.d)}</td></tr>`;
      }).join('');
      return `<div class="gen-ep-card"><div class="gen-ep-hdr"><span class="gen-method">POST</span><h5>${cfg.baseUrl}${ep.path}</h5><span class="gen-proto-badge ${protocol}">${protocol}</span></div><table class="gen-ep-table"><thead><tr><th>Par√°metro</th><th>Valor</th><th>Default</th></tr></thead><tbody>${rows}</tbody></table></div>`;
    }

    // ‚îÄ‚îÄ Preview tabs ‚îÄ‚îÄ
    function genSwitchTab(name, el) {
      document.querySelectorAll('.gen-prev-tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      ['live','html','api'].forEach(t => {
        const pane = $('gen-tab-' + t);
        pane.classList.toggle('active', t === name);
      });
    }

    // ‚îÄ‚îÄ Copy ‚îÄ‚îÄ
    function genCopy(id) {
      const el = $(id);
      const text = el.textContent;
      const done = () => {
        const btn = el.closest('.gen-code-block').querySelector('.gen-copy-btn');
        btn.textContent = '‚úÖ Copiado'; btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'üìã Copiar'; btn.classList.remove('copied'); }, 2000);
      };
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(done);
      } else {
        const ta = document.createElement('textarea');
        ta.value = text; ta.style.cssText = 'position:fixed;left:-9999px';
        document.body.appendChild(ta); ta.select(); document.execCommand('copy');
        document.body.removeChild(ta); done();
      }
    }

    // ‚îÄ‚îÄ Main update ‚îÄ‚îÄ
    function genUpdate() {
      $('gv-topk').textContent = $('gen-topk').value;
      $('gv-temperature').textContent = (parseInt($('gen-temperature').value) / 100).toFixed(1);
      $('gv-similarity').textContent = (parseInt($('gen-similarity').value) / 100).toFixed(2);
      $('gv-maxtokens').textContent = $('gen-maxtokens').value;
      $('gv-maxhistory').textContent = $('gen-maxhistory').value;

      const cfg = genGetConfig();
      const cap = CAPS[cfg.widget];
      const protocol = cap.hasProtocol ? cfg.protocol : cap.protocols[0];

      // HTML embed
      $('gen-code-embed').textContent = genBuildEmbed(cfg);
      // cURL
      $('gen-code-curl').textContent = genBuildCurl(cfg);
      // Endpoint summary
      $('gen-ep-summary').innerHTML = genBuildEpSummary(cfg);
      // Footer
      $('gen-footer-widget').textContent = cap.tag;
      $('gen-footer-proto').textContent = protocol;
      $('gen-footer-stream').textContent = String(cfg.streaming);

      genUpdatePreview();
    }

    function genUpdatePreview() {
      const host = $('gen-preview-host');
      host.innerHTML = '';
      const cfg = genGetConfig();
      const cap = CAPS[cfg.widget];
      const el = document.createElement(cap.tag);

      if (cap.endpointSuffix) {
        el.setAttribute(cap.baseUrlAttr, cfg.baseUrl + cap.endpointSuffix);
      } else {
        el.setAttribute(cap.baseUrlAttr, cfg.baseUrl);
      }

      if (cap.hasProtocol) el.setAttribute('protocol', cfg.protocol);
      if (cap.hasAgent) el.setAttribute('agent', cfg.agent);
      if (cap.hasApiKey && cfg.apiKey) el.setAttribute('api-key', cfg.apiKey);
      if (cap.hasModel) el.setAttribute('model', cfg.model);
      if (cap.hasTopK) el.setAttribute('top-k', cfg.topK);
      if (cap.hasTemperature) el.setAttribute('temperature', cfg.temperature);
      if (cap.hasMaxHistory) el.setAttribute('max-history', cfg.maxHistory);
      if (cap.hasToolName) el.setAttribute('tool-name', cfg.toolName);
      if (cap.hasSystemPrompt && cfg.systemPrompt) el.setAttribute('system-prompt', cfg.systemPrompt);
      if (cap.hasStreaming) el.setAttribute('streaming', cfg.streaming);
      el.setAttribute('stream', String(cfg.streaming));
      if (cap.hasSources) el.setAttribute('show-sources', cfg.sources);
      el.setAttribute('include-sources', String(cfg.sources));
      if (cap.hasConfidence) el.setAttribute('show-confidence', cfg.confidence);
      if (cap.hasGrounding) el.setAttribute('show-grounding', cfg.grounding);
      if (cap.hasFeedback) el.setAttribute('feedback', cfg.feedback);
      // Force inline in preview
      el.setAttribute('position', 'inline');
      if (cap.hasLocale) el.setAttribute('locale', cfg.locale);
      if (cap.hasTitle) el.setAttribute('title', cfg.title);
      if (cap.hasPlaceholder) el.setAttribute('placeholder', cfg.placeholder);
      if (cap.hasSessionId) el.setAttribute('session-id', cfg.sessionId);
      if (cap.hasColor && cap.tag !== 'draga-chat') el.setAttribute('theme-color', cfg.color);
      if (cap.hasColor && cap.tag === 'draga-chat') el.style.setProperty('--draga-primary', cfg.color);

      host.appendChild(el);
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    genApplyVisibility();
    genUpdate();
  </script>
</body>
</html>
