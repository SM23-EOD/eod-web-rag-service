<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo Widget OpenAI Compatible | Envios23</title>
  <style>
    :root {
      --bg: #0f172a;
      --surface: #1e293b;
      --border: #334155;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #059669;
      --accent2: #2563eb;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 0;
    }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, #059669 0%, #065f46 100%);
      padding: 60px 40px;
      text-align: center;
    }

    .hero h1 {
      font-size: 2.4em;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .hero h1 span {
      background: rgba(255,255,255,0.15);
      padding: 4px 16px;
      border-radius: 8px;
    }

    .hero p {
      font-size: 1.1em;
      opacity: 0.9;
      max-width: 700px;
      margin: 0 auto 20px;
      line-height: 1.6;
    }

    .hero-badges {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: rgba(255,255,255,0.15);
      border-radius: 20px;
      font-size: 13px;
      backdrop-filter: blur(4px);
    }

    /* Main content */
    .content {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* Comparison table */
    .comparison {
      margin-bottom: 48px;
    }

    .comparison h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .proto-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--surface);
      border-radius: 12px;
      overflow: hidden;
    }

    .proto-table th,
    .proto-table td {
      padding: 14px 18px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    .proto-table th {
      background: rgba(255,255,255,0.05);
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.5px;
    }

    .proto-table tr:last-child td {
      border-bottom: none;
    }

    .proto-table .tag {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .tag-openai { background: #ecfdf5; color: #059669; }
    .tag-mcp { background: #eff6ff; color: #2563eb; }
    .tag-query { background: #fef3c7; color: #92400e; }

    code {
      background: rgba(255,255,255,0.08);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    /* Config panel */
    .config-section {
      margin-bottom: 48px;
    }

    .config-section h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .config-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .config-card label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 8px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .config-card input,
    .config-card select {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }

    .config-card input:focus,
    .config-card select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.15);
    }

    .config-card .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    .btn-row {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #059669, #047857);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    /* Usage code */
    .usage {
      margin-bottom: 48px;
    }

    .usage h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .code-block {
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.7;
      overflow-x: auto;
      position: relative;
      margin-bottom: 16px;
    }

    .code-block .comment { color: #6a9955; }
    .code-block .tag { color: #569cd6; background: none; padding: 0; }
    .code-block .attr { color: #9cdcfe; }
    .code-block .str { color: #ce9178; }
    .code-block .kw { color: #c586c0; }

    .code-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 600;
    }

    /* API comparison */
    .api-flow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .flow-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .flow-card h3 {
      font-size: 15px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .flow-card pre {
      background: #0d1117;
      border-radius: 8px;
      padding: 16px;
      font-size: 12px;
      line-height: 1.6;
      overflow-x: auto;
    }

    .flow-card .arrow {
      text-align: center;
      padding: 8px;
      color: var(--muted);
    }

    /* Status bar */
    .status-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      z-index: 100;
    }

    .status-bar .left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .status-dot.green { background: #10b981; }
    .status-dot.yellow { background: #f59e0b; }
    .status-dot.red { background: #ef4444; }

    @media (max-width: 768px) {
      .hero { padding: 40px 20px; }
      .hero h1 { font-size: 1.8em; }
      .api-flow { grid-template-columns: 1fr; }
      .content { padding: 24px 16px; }
    }
  </style>
</head>
<body>

  <nav id="site-breadcrumb" style="display:flex;align-items:center;gap:8px;padding:6px 20px;background:#0f172a;font-size:12px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;border-bottom:1px solid #1e293b;flex-wrap:wrap;"><a href="integration.html" style="color:#93c5fd;text-decoration:none;font-weight:600;">üè† Hub</a><span style="color:#475569;">‚Ä∫</span><a href="integration.html" style="color:#94a3b8;text-decoration:none;">Widgets</a><span style="color:#475569;">‚Ä∫</span><span style="color:#cbd5e1;font-weight:500;">OpenAI Widget</span><span style="color:#334155;margin:0 4px 0 auto;">|</span><a href="demo-draga-chat.html" style="color:#64748b;text-decoration:none;font-size:11px;padding:2px 6px;">üí¨ DRAGA</a><a href="demo-widget-v2.html" style="color:#64748b;text-decoration:none;font-size:11px;padding:2px 6px;">ü§ñ V2</a><a href="index.html" style="color:#64748b;text-decoration:none;font-size:11px;padding:2px 6px;">üì¶ V1</a></nav>

  <!-- Status bar -->
  <div class="status-bar">
    <div class="left">
      <div class="status-item">
        <span class="status-dot green" id="apiStatus"></span>
        <span id="apiStatusText">API: checking...</span>
      </div>
      <div class="status-item">
        <span class="status-dot yellow" id="streamStatus"></span>
        <span id="streamStatusText">Stream: idle</span>
      </div>
    </div>
    <div>
      <span style="color:var(--muted)">Widget OpenAI ¬∑ Envios23 RAG</span>
    </div>
  </div>

  <!-- Hero -->
  <div class="hero" style="margin-top: 35px;">
    <h1>‚ö° Widget <span>OpenAI Compatible</span></h1>
    <p>
      Prueba el protocolo OpenAI Chat Completions (<code style="background:rgba(255,255,255,.2);color:#fff">/api/v2/chat/completions</code>)
      con streaming SSE en tiempo real. Compara con el protocolo MCP que usan los widgets existentes.
    </p>
    <div class="hero-badges">
      <span class="badge">üî¥ SSE Streaming</span>
      <span class="badge">üì¶ Batch mode</span>
      <span class="badge">üí¨ Chat history</span>
      <span class="badge">üé® Personalizable</span>
      <span class="badge">‚ö° Web Component</span>
    </div>
  </div>

  <!-- Content -->
  <div class="content">

    <!-- Protocol comparison -->
    <div class="comparison">
      <h2>üì° Comparaci√≥n de Protocolos</h2>
      <table class="proto-table">
        <thead>
          <tr>
            <th>Aspecto</th>
            <th>MCP (Widgets v1/v2)</th>
            <th>OpenAI Compatible (Este widget)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Endpoint</td>
            <td><code>/api/v2/mcp/tools/call</code></td>
            <td><code>/api/v2/chat/completions</code></td>
          </tr>
          <tr>
            <td>Protocolo</td>
            <td><span class="tag tag-mcp">MCP Tool Call</span></td>
            <td><span class="tag tag-openai">OpenAI Chat API</span></td>
          </tr>
          <tr>
            <td>Streaming</td>
            <td>‚ùå No soportado</td>
            <td>‚úÖ SSE (Server-Sent Events)</td>
          </tr>
          <tr>
            <td>Historial de conversaci√≥n</td>
            <td>Solo <code>session_id</code> server-side</td>
            <td>Array <code>messages[]</code> completo (client-side)</td>
          </tr>
          <tr>
            <td>Formato request</td>
            <td><code>{ tool_name, arguments, session_id }</code></td>
            <td><code>{ model, messages[], stream, temperature }</code></td>
          </tr>
          <tr>
            <td>Formato response</td>
            <td><code>{ success, result, sources, confidence }</code></td>
            <td><code>{ choices[].message.content, usage }</code></td>
          </tr>
          <tr>
            <td>Compatible con</td>
            <td>S√≥lo esta API</td>
            <td>OpenAI, LiteLLM, Ollama, vLLM, etc.</td>
          </tr>
          <tr>
            <td>System prompt</td>
            <td>Configurado en el servidor</td>
            <td>Configurable desde el cliente</td>
          </tr>
          <tr>
            <td>Par√°metros</td>
            <td><code>include_sources</code></td>
            <td><code>temperature</code>, <code>top_k</code>, <code>model</code></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- API Flow comparison -->
    <div class="comparison">
      <h2>üîÑ Flujo de Request/Response</h2>
      <div class="api-flow">
        <div class="flow-card">
          <h3><span class="tag tag-mcp">MCP</span> Widgets v1/v2</h3>
<pre style="color:#e2e8f0">
<span style="color:#6a9955">// Request</span>
POST /api/v2/mcp/tools/call
{
  "tool_name": "generate_rag_answer",
  "arguments": {
    "query": "¬øC√≥mo rastreo mi env√≠o?",
    "include_sources": true
  },
  "session_id": "web-abc123"
}

<span style="color:#6a9955">// Response (completa)</span>
{
  "success": true,
  "result": "Para rastrear tu env√≠o...",
  "sources": ["guia-envios.pdf"],
  "confidence": 0.92
}
</pre>
        </div>
        <div class="flow-card">
          <h3><span class="tag tag-openai">OpenAI</span> Este widget</h3>
<pre style="color:#e2e8f0">
<span style="color:#6a9955">// Request</span>
POST /api/v2/chat/completions
{
  "model": "eod-rag",
  "messages": [
    {"role": "user", "content": "¬øC√≥mo rastreo?"}
  ],
  "stream": true,
  "top_k": 5,
  "temperature": 0.7
}

<span style="color:#6a9955">// Response (streaming SSE)</span>
data: {"choices":[{"delta":{"content":"Para "}}]}
data: {"choices":[{"delta":{"content":"rastrear "}}]}
data: {"choices":[{"delta":{"content":"tu env√≠o..."}}]}
data: [DONE]
</pre>
        </div>
      </div>
    </div>

    <!-- Config panel -->
    <div class="config-section">
      <h2>‚öôÔ∏è Configuraci√≥n del Widget</h2>
      <div class="config-grid">
        <div class="config-card">
          <label>Endpoint Base</label>
          <input type="text" id="cfgEndpoint" value="/api/v2">
          <div class="hint">Base URL del API (sin /chat/completions)</div>
        </div>
        <div class="config-card">
          <label>Modelo</label>
          <input type="text" id="cfgModel" value="eod-rag">
          <div class="hint">Modelo RAG disponible en el servidor</div>
        </div>
        <div class="config-card">
          <label>Streaming</label>
          <select id="cfgStream">
            <option value="true" selected>‚úÖ Streaming SSE (recomendado)</option>
            <option value="false">üì¶ Batch (respuesta completa)</option>
          </select>
          <div class="hint">SSE entrega tokens en tiempo real</div>
        </div>
        <div class="config-card">
          <label>Temperature</label>
          <input type="number" id="cfgTemp" value="0.7" min="0" max="2" step="0.1">
          <div class="hint">0 = determin√≠stico, 2 = m√°s creativo</div>
        </div>
        <div class="config-card">
          <label>Top-K Documentos</label>
          <input type="number" id="cfgTopK" value="5" min="1" max="20">
          <div class="hint">Documentos RAG a consultar</div>
        </div>
        <div class="config-card">
          <label>Color del tema</label>
          <input type="color" id="cfgColor" value="#059669">
          <div class="hint">Color principal del widget</div>
        </div>
        <div class="config-card">
          <label>System Prompt (opcional)</label>
          <input type="text" id="cfgSystem" placeholder="Eres un asistente de env√≠os...">
          <div class="hint">Instrucciones del sistema para el modelo</div>
        </div>
        <div class="config-card">
          <label>Posici√≥n</label>
          <select id="cfgPosition">
            <option value="bottom-right" selected>‚Üò Abajo derecha</option>
            <option value="bottom-left">‚Üô Abajo izquierda</option>
          </select>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" onclick="applyConfig()">‚ö° Aplicar Configuraci√≥n</button>
        <button class="btn btn-secondary" onclick="resetConfig()">‚Üª Reset</button>
        <button class="btn btn-secondary" onclick="checkHealth()">ü©∫ Health Check</button>
      </div>
    </div>

    <!-- Usage -->
    <div class="usage">
      <h2>üìã C√≥mo usarlo</h2>

      <div class="code-label">Uso m√≠nimo:</div>
      <div class="code-block">
<span class="comment">&lt;!-- Cargar dependencias --&gt;</span>
&lt;<span class="tag">script</span> <span class="attr">src</span>=<span class="str">"https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"</span>&gt;&lt;/<span class="tag">script</span>&gt;
&lt;<span class="tag">script</span> <span class="attr">src</span>=<span class="str">"./src/assistant-widget-openai.js"</span>&gt;&lt;/<span class="tag">script</span>&gt;

<span class="comment">&lt;!-- Widget con streaming --&gt;</span>
&lt;<span class="tag">rag-assistant-openai</span>
  <span class="attr">endpoint</span>=<span class="str">"/api/v2"</span>
  <span class="attr">model</span>=<span class="str">"eod-rag"</span>
  <span class="attr">stream</span>=<span class="str">"true"</span>
&gt;&lt;/<span class="tag">rag-assistant-openai</span>&gt;
      </div>

      <div class="code-label">Con todas las opciones:</div>
      <div class="code-block">
&lt;<span class="tag">rag-assistant-openai</span>
  <span class="attr">endpoint</span>=<span class="str">"/api/v2"</span>
  <span class="attr">model</span>=<span class="str">"eod-rag"</span>
  <span class="attr">stream</span>=<span class="str">"true"</span>
  <span class="attr">title</span>=<span class="str">"Asistente Envios23"</span>
  <span class="attr">temperature</span>=<span class="str">"0.7"</span>
  <span class="attr">top-k</span>=<span class="str">"5"</span>
  <span class="attr">theme-color</span>=<span class="str">"#059669"</span>
  <span class="attr">position</span>=<span class="str">"bottom-right"</span>
  <span class="attr">system-prompt</span>=<span class="str">"Eres un asistente de log√≠stica. Responde en espa√±ol."</span>
  <span class="attr">placeholder</span>=<span class="str">"Preg√∫ntame sobre env√≠os..."</span>
&gt;&lt;/<span class="tag">rag-assistant-openai</span>&gt;
      </div>

      <div class="code-label">Usar v√≠a JavaScript / api-client.js:</div>
      <div class="code-block">
<span class="comment">// Batch (sin streaming)</span>
<span class="kw">const</span> result = <span class="kw">await</span> api.chatCompletions({
  model: <span class="str">'eod-rag'</span>,
  messages: [{ role: <span class="str">'user'</span>, content: <span class="str">'¬øC√≥mo rastreo mi env√≠o?'</span> }],
  top_k: 5
});
console.log(result.choices[0].message.content);

<span class="comment">// Streaming SSE</span>
<span class="kw">await</span> api.chatCompletionsStream(
  { model: <span class="str">'eod-rag'</span>, messages: [...] },
  (chunk) => { <span class="comment">/* cada token */</span> console.log(chunk.choices[0].delta.content); },
  () => { <span class="comment">/* done */</span> console.log(<span class="str">'Completado'</span>); }
);
      </div>
    </div>

  </div>

  <!-- Load widget -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
  <script src="./src/assistant-widget-openai.js"></script>

  <rag-assistant-openai
    id="openaiWidget"
    endpoint="/api/v2"
    model="eod-rag"
    stream="true"
    title="Asistente OpenAI"
    top-k="5"
    temperature="0.7"
    theme-color="#059669"
    position="bottom-right"
    placeholder="Prueba el protocolo OpenAI..."
  ></rag-assistant-openai>

  <script>
    const widget = document.getElementById('openaiWidget');

    function applyConfig() {
      widget.setAttribute('endpoint', document.getElementById('cfgEndpoint').value);
      widget.setAttribute('model', document.getElementById('cfgModel').value);
      widget.setAttribute('stream', document.getElementById('cfgStream').value);
      widget.setAttribute('temperature', document.getElementById('cfgTemp').value);
      widget.setAttribute('top-k', document.getElementById('cfgTopK').value);
      widget.setAttribute('theme-color', document.getElementById('cfgColor').value);
      widget.setAttribute('position', document.getElementById('cfgPosition').value);

      const system = document.getElementById('cfgSystem').value;
      if (system) widget.setAttribute('system-prompt', system);
      else widget.removeAttribute('system-prompt');

      // Flash feedback
      document.querySelector('.btn-primary').textContent = '‚úÖ Aplicado!';
      setTimeout(() => {
        document.querySelector('.btn-primary').textContent = '‚ö° Aplicar Configuraci√≥n';
      }, 1500);
    }

    function resetConfig() {
      document.getElementById('cfgEndpoint').value = '/api/v2';
      document.getElementById('cfgModel').value = 'eod-rag';
      document.getElementById('cfgStream').value = 'true';
      document.getElementById('cfgTemp').value = '0.7';
      document.getElementById('cfgTopK').value = '5';
      document.getElementById('cfgColor').value = '#059669';
      document.getElementById('cfgPosition').value = 'bottom-right';
      document.getElementById('cfgSystem').value = '';
      applyConfig();
    }

    async function checkHealth() {
      const base = document.getElementById('cfgEndpoint').value;
      const dot = document.getElementById('apiStatus');
      const text = document.getElementById('apiStatusText');

      try {
        // Check health
        const res = await fetch(`${base}/health`);
        if (res.ok) {
          const data = await res.json();
          dot.className = 'status-dot green';
          text.textContent = `API: OK (${data.status || 'healthy'})`;
        } else {
          dot.className = 'status-dot red';
          text.textContent = `API: Error ${res.status}`;
        }

        // Check models
        try {
          const modelsRes = await fetch(`${base}/models`);
          if (modelsRes.ok) {
            const models = await modelsRes.json();
            const modelList = models.data?.map(m => m.id).join(', ') || 'n/a';
            console.log('Modelos disponibles:', modelList);
          }
        } catch { /* optional */ }

      } catch (e) {
        dot.className = 'status-dot red';
        text.textContent = `API: ${e.message}`;
      }
    }

    // Auto health check on load
    checkHealth();
  </script>
</body>
</html>
